system {
    host-name pod1-leaf1;
    auto-snapshot;
    time-zone UTC;
    root-authentication {
        encrypted-password "$6$jJtJzKNY$ae59syphgyFSFi75Mt9l3BHXz8oxrQnFJ/8ZlQkZSL4ej.MKXiyOIiqmsm/5OXCsvGcvDjmw7f0pIbHTdIFpt/";
    }
    commit {
        synchronize;
        no-delta-synchronize;
    }
    login {
        message "\n\n\n\t       * * *  W A R N I N G  * * *\n\tProperty of the XYZ\n\nIf you are not authorized to access this system, disconnect now.\nUsers of this system have no expectation of privacy. By continuing,\nyou consent to your keystrokes and data content being monitored.\n\n";
        retry-options {
            tries-before-disconnect 3;
            backoff-threshold 1;
            backoff-factor 6;
            minimum-time 30;
        }
        class SUPER-USER-REMOTE {
            idle-timeout 10;
            permissions all;
        }
        user remote {
            full-name AAA-Null-User;
            uid 9999;
            class SUPER-USER-REMOTE;
        }
        user testlab {
            uid 4000;
            class super-user;
            authentication {
                ssh-rsa "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDFLSYKW+I2qjeteBEp11YjnmzhsLiPmGFUqiuiYKh1wkhaxDHeF49ZRej2xZ85+yYcbxV6JDrGEsi3UZDI4Kii3sSgDw1uMCg/nxSyXxRwLSL3B++qylf1p1PX+dSMXhaocvuLZLurfq5S9pcWYdrb+F8SWvDfcKCj9yLVPcNY+TQ2YCNarPw7B3/am6S+In0a6trgnwry5RppeEn1CaAD57vc/WeEcd3WGYmlWOjNIhm08vcrv2HIKF6uNcuRCbMKWMqwn2lP/b0cR7XvO1ZUyvUu5m1pm0z/k6rvKGd1LOKuI2/oKOKMB4ZvzXSkO1OhGuXceykkRVTzt82xM4tB";
                encrypted-password "$6$zl1MOs9B$jDwJhvlYTw8nOphSAW6.A0Y8kitXEeLmrLfZrgipg9E5rA8fc0nec0isbx5MtXLYsixUqx3OhKx1AaYl8fYEs0";
            }
        }
    }
    services {
        ssh {
            root-login deny;
            protocol-version v2;
            connection-limit 5;
            rate-limit 5;
        }
        netconf {
            ssh {
                connection-limit 10;
                rate-limit 60;
            }
            rfc-compliant;
            yang-compliant;
        }
    }
    internet-options {
        tcp-drop-synfin-set;
    }
    authentication-order password;
    ports {
        console log-out-on-disconnect;
        auxiliary {
            disable;
            insecure;
        }
    }
    syslog {
        user * {
            any emergency;
        }
        host 4.4.4.4 {
            any notice;
            authorization any;
            firewall any;
            interactive-commands any;
            structured-data;
        }
        file messages {
            any any;
            authorization info;
        }
        file interactive-commands {
            interactive-commands any;
        }
    }
    name-server {
        8.8.8.8;
        8.8.4.4;
    }
    ntp {
        server 4.5.4.5;
    }
}
chassis {
    aggregated-devices {
        ethernet {
            device-count 48;
        }
    }
    forwarding-options {
        vxlan-gbp-profile;
    }
}
interfaces {
    et-0/0/53 {
        description "EVPN_UPLINK: pod1-spine1 et-0/0/0";
        mtu 9192;
        unit 0 {
            family inet {
                address 10.44.250.0/31;
            }
            family inet6 {
                address 2001:db8:250::0/127;
            }
        }
    }
    et-0/0/54 {
        description "EVPN_UPLINK: pod1-spine2 et-0/0/0";
        mtu 9192;
        unit 0 {
            family inet {
                address 10.44.250.2/31;
            }
            family inet6 {
                address 2001:db8:250::2/127;
            }
        }
    }
     mge-0/0/0 {
        description "host facing";
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members [ VLAN101 ];
                }
            }
        }
    }
    mge-0/0/1 {
        description "host facing";
        unit 0 {
            family ethernet-switching {
                interface-mode trunk;
                vlan {
                    members [ VLAN101, VLAN201 ];
                }
            }
        }
    }
    mge-0/0/2 {
        description "ae2 test local AE";
        ether-options {
            802.3ad ae2;
        }
    }
    mge-0/0/3 {
        description "ae3 test with ESI";
        ether-options {
            802.3ad ae3;
        }
    }
    ae2 {
        description "host facing";
        aggregated-ether-options {
            lacp {
                active;
                system-id 00:00:5e:e4:31:57;
            }
        }
        unit 0 {
            family ethernet-switching {
                interface-mode access;
                vlan {
                    members [ VLAN201 ];
                }
            }
        }
    }
    ae3 {
        description "host facing";
        esi {
            00:01:03:00:00:00:00:00:00:00;
            all-active;
        }
        aggregated-ether-options {
            lacp {
                active;
                system-id 00:00:5e:e4:31:57;
            }
        }
        unit 0 {
            family ethernet-switching {
                interface-mode trunk;
                vlan {
                    members [ VLAN101, VLAN201 ];
                }
            }
        }
    }
    vme {
        unit 0 {
            family inet {
                address 10.192.16.135/23;
            }
        }
    }
    irb {
        unit 101 {
            description "campus";
            family inet {
                address 10.44.101.1/24;
            }
            family inet6 {
                address 2001:db8:44:101::1/64;
                address fe80:44:101::1/64;
            }
            mac 00:00:5e:e4:31:57;
        }
        unit 201 {
            description "campus";
            family inet {
                address 10.44.200.1/24;
            }
            family inet6 {
                address 2001:db8:44:200::1/64;
                address fe80:44:200::1/64;
            }
            mac 00:00:5e:e4:31:57;
        }
    }
    lo0 {
        unit 0 {
            family inet {
                filter {
                    input SERVICE-IN;
                }
                address 10.44.255.1/32;
            }
            family inet6 {
                filter {
                    input SERVICE-IN-V6;
                }
                address 2001:db8:255::1/128;
            }
        }
        unit 1 {
            family inet {
                filter {
                    input SERVICE-IN;
                }
                address 10.44.254.1/32;
            }
            family inet6 {
                filter {
                    input SERVICE-IN-V6;
                }
                address 2001:db8:254::1/128;
            }
        }
    }
}
forwarding-options {
    storm-control-profiles default {
        all;
    }
    evpn-vxlan {
        shared-tunnels;
    }
    vxlan-routing {
        overlay-ecmp;
    }
}
routing-options {
    static {
        route 0.0.0.0/0 next-hop 10.192.16.1;
    }
    router-id 10.44.255.1;
    authonomous-system 65001;
    forwarding-table {
        export PFE-LB;
        ecmp-fast-reroute;
        chained-composite-next-hop {
            ingress {
                evpn;
            }
        }
    }
}
protocols {
    igmp {
        interface all {
            version 3;
        }
    }
    mld {
        interface all {
            version 2;
        }
    }
    router-advertisement {
        interface irb.101 {
            prefix 2001:db8:44:101::/64;
        }
    }
    lldp {
        port-id-subtype interface-name;
        neighbour-port-info-display port-id;
        interface all;
    }
    lldp-med {
        interface all;
    }
    bgp {
        group EVPN-UNDERLAY {
            type external;
            connect-retry-interval 2;
            mtu-discovery;
            log-updown;
            family inet6 {
                unicast;
            }
            authentication-key "$9$rjyKWXVwgUjq7-jqmfn6revW7-"
            export UNDERLAY-BGP-OUT;
            local-as 65001;
            graceful-restart {
                disable;
            }
            multipath {
                multiple-as;
            }
            bfd-liveness-detection {
                minimum-interval 1000;
                multiplier 3;
            }
            neighbor 2001:db8:250::1 {
                description pod1-spine1;
                peer-as 65005;
            }
            neighbor 2001:db8:250::3 {
                description pod1-spine2;
                peer-as 65006;
            }
        }
        group EVPN-OVERLAY {
            type external;
            multihop {
                ttl 1;
                no-nexthop-change;
            }
            connect-retry-interval 2;			
            local-address 2001:db8:255::1;
            mtu-discovery;
            log-updown;
            family evpn {
                signaling{
                    loops 2;
                }
            }
            authentication-key "$9$rjyKWXVwgUjq7-jqmfn6revW7-"
            local-as 65001;
            graceful-restart {
                disable;
			}
            multipath{
                multiple-as;
            }
            bfd-liveness-detection {
                minimum-interval 1000;
                multiplier 3;
                session-mode automatic;
            }
            neighbor 2001:db8:255::5 {
                description pod1-spine1;
                peer-as 65005;
                }
            }
            neighbor 2001:db8:255::6 {
                description pod1-spine2;
                peer-as 65006;
                }
            }
        }
    }
}
policy-options {
    policy-statement PFE-LB {
        then {
            load-balance per-packet;
        }
    }
    policy-statement UNDERLAY-BGP-OUT {
        term ADVERTISE {
            from {
                protocol direct;
                route-filter 10.44.255.1/32 exact;
                route-filter 2001:db8:255::1/128 exact;
            }
            then accept;
        }
    }
    policy-statement EXPORT-T5 {
        term direct {
            from protocol direct;
            then accept;
        }
    }
}
routing-instances {
    evpn_vs {
        instance-type mac-vrf;
        protocols {
            evpn {
                encapsulation vxlan;
                default-gateway do-not-advertise;
                extended-vni-list all;
            }
        }
        vtep-source-interface lo0.0 inet6;
        service-type vlan-aware;
        interface mge-0/0/0;
        interface mge-0/0/1;
        route-distinguisher  10.44.255.1:1;
        vrf-target target:65000:1;
        vlans {
            default {
                vlan-id 1;
            }
            VLAN101 {
                description "campus";
                vlan-id 101;
                l3-interface irb.101;
                vxlan {
                    vni 100101;
                }
            }
            VLAN200 {
                description "IOT_NETWORK";
                vlan-id 200;
                vxlan {
                    vni 100200;
                }
            }
            VLAN201 {
                description "campus";
                vlan-id 201;
                l3-interface irb.201;
                vxlan {
                    vni 100201;
                }
            }
        }
    }
    CAMPUS {
        instance-type vrf;
        routing-options {
            multipath;
            auto-export;
        }
        protocols {
            evpn {
                ip-prefix-routes {
                    advertise direct-nexthop;
                    encapsulation vxlan;
                    vni 199101;
                    export EXPORT-T5;
                }
            }
        }
        interface lo0.1;
        interface irb.101;
        interface irb.201;
        route-distinguisher 10.44.255.1:101;
        vrf-target target:65000:101;
        vrf-table-label;
}

